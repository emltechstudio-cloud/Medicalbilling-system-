<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Medical Billing System - Multi-Clinic P2P</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
    }

    /* Clinic Setup Styles */
    .setup-section {
      background: white;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      max-width: 500px;
      margin: 0 auto;
      text-align: center;
    }

    .setup-options {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin: 30px 0;
    }

    .setup-option {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .setup-option:hover {
      border-color: #667eea;
      transform: translateY(-2px);
    }

    .clinic-form {
      margin-top: 15px;
    }

    .form-group {
      margin-bottom: 15px;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
    }

    .form-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .submit-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px;
      border-radius: 6px;
      width: 100%;
      cursor: pointer;
      margin-top: 10px;
    }

    /* Clinic Dashboard Styles */
    .clinic-dashboard {
      display: none;
    }

    .clinic-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 20px;
      background: white;
      border-radius: 15px;
    }

    .clinic-info h2 {
      color: #2c3e50;
      margin-bottom: 5px;
    }

    .clinic-details {
      color: #666;
      font-size: 14px;
    }

    .dashboard-content {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 20px;
    }

    .clinic-sidebar {
      background: white;
      padding: 20px;
      border-radius: 15px;
    }

    .online-staff {
      margin-bottom: 20px;
    }

    .staff-list {
      max-height: 150px;
      overflow-y: auto;
    }

    .staff-item {
      padding: 8px;
      border-bottom: 1px solid #e0e0e0;
    }

    .clinic-actions {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 20px;
    }

    .clinic-btn {
      padding: 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .medical-billing-ui {
      background: white;
      border-radius: 15px;
      padding: 20px;
      min-height: 500px;
    }

    /* Medical Billing Styles */
    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    .option-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      margin-bottom: 15px;
    }

    .option-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 35px rgba(0,0,0,0.15);
      border-color: #667eea;
    }

    .option-card .icon {
      font-size: 30px;
      margin-bottom: 10px;
      text-align: center;
    }

    .card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .medical-claims-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .medical-claim-item {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .notes-options {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }

    .notes-tab {
      flex: 1;
      padding: 12px;
      background: #e9ecef;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .notes-tab.active {
      background: #667eea;
      color: white;
    }

    .hidden {
      display: none !important;
    }

    .metadata-summary {
      background: #e3f2fd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 10px;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-success {
      background: #28a745;
      color: white;
    }

    .back-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 10px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      width: 40px;
      height: 40px;
      margin-bottom: 20px;
    }

    .claim-output {
      background: #f8f9fa;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      padding: 15px;
      min-height: 200px;
      font-family: monospace;
      white-space: pre-wrap;
      width: 100%;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .action-buttons .btn {
      flex: 1;
      margin-top: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Clinic Setup Screen -->
    <div id="setupScreen">
      <div class="header">
        <h1>Medical Billing System</h1>
        <p>Multi-Clinic P2P Platform</p>
      </div>
      
      <div class="setup-section">
        <h2>Setup Your Clinic</h2>
        
        <div class="setup-options">
          <div class="setup-option" onclick="showForm('create')">
            <h3>üè• Create New Clinic</h3>
            <p>Start a new medical practice</p>
            <div id="createClinicForm" class="clinic-form" style="display: none;">
              <div class="form-group">
                <label>Clinic Name</label>
                <input type="text" id="clinicName" placeholder="City General Hospital">
              </div>
              <div class="form-group">
                <label>Your Name (Administrator)</label>
                <input type="text" id="adminName" placeholder="Dr. John Smith">
              </div>
              <button class="submit-btn" onclick="createClinic()">Create Clinic</button>
            </div>
          </div>
          
          <div class="setup-option" onclick="showForm('join')">
            <h3>üë• Join Existing Clinic</h3>
            <p>Join using Clinic ID</p>
            <div id="joinClinicForm" class="clinic-form" style="display: none;">
              <div class="form-group">
                <label>Clinic ID</label>
                <input type="text" id="joinClinicId" placeholder="CLINIC-XXXXXXX">
              </div>
              <div class="form-group">
                <label>Your Name</label>
                <input type="text" id="staffName" placeholder="Your full name">
              </div>
              <button class="submit-btn" onclick="joinClinic()">Join Clinic</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Clinic Dashboard -->
    <div id="clinicDashboard" class="clinic-dashboard">
      <div class="clinic-header">
        <div class="clinic-info">
          <h2 id="dashboardClinicName">Clinic Name</h2>
          <div class="clinic-details">
            Clinic ID: <strong id="dashboardClinicId">CLINIC-XXXXXXX</strong> ‚Ä¢ 
            Role: <strong id="dashboardUserRole">Staff</strong>
          </div>
        </div>
        <button class="clinic-btn" style="background: #e74c3c; color: white;" onclick="leaveClinic()">Leave Clinic</button>
      </div>
      
      <div class="dashboard-content">
        <!-- Clinic Sidebar -->
        <div class="clinic-sidebar">
          <div class="online-staff">
            <h4>üë• Online Staff (<span id="onlineCount">0</span>)</h4>
            <div class="staff-list" id="staffList"></div>
          </div>
          
          <div class="clinic-actions">
            <button class="clinic-btn" style="background: #667eea; color: white;" onclick="showMedicalBilling()">
              üìã Medical Billing
            </button>
            <button class="clinic-btn" style="background: #28a745; color: white;" onclick="exportClinicData()">
              üìä Export Data
            </button>
          </div>
        </div>
        
        <!-- Medical Billing Interface -->
        <div class="medical-billing-ui">
          <button class="back-btn" id="medicalBackBtn" onclick="showClinicDashboard()" style="display: none;">‚Üê</button>
          
          <!-- HOME SCREEN -->
          <div id="homeScreen" class="screen active">
            <div class="option-card" onclick="showMedicalScreen('claimsScreen')">
              <div class="icon">üìã</div>
              <h3>View Claims</h3>
              <p>Review and manage saved medical claims</p>
            </div>
            
            <div class="option-card" onclick="showMedicalScreen('newClaimScreen')">
              <div class="icon">‚ûï</div>
              <h3>Generate New Claim</h3>
              <p>Create a new medical billing claim</p>
            </div>
          </div>

          <!-- CLAIMS HISTORY SCREEN -->
          <div id="claimsScreen" class="screen">
            <div class="card">
              <h2 style="margin-bottom: 20px;">Saved Claims</h2>
              <div class="medical-claims-list" id="medicalClaimsList"></div>
              <div id="noClaimsMessage" style="color: #666; padding: 20px; text-align: center;">
                No saved claims yet. Generate your first claim!
              </div>
            </div>
          </div>

          <!-- NEW CLAIM FORM SCREEN -->
          <div id="newClaimScreen" class="screen">
            <div class="card">
              <h2 style="margin-bottom: 20px;">Patient Information</h2>
              
              <form id="patientForm">
                <div class="form-group">
                  <label>Patient Name *</label>
                  <input type="text" id="patientName" required>
                </div>
                
                <div class="form-group">
                  <label>Age *</label>
                  <input type="number" id="age" required>
                </div>
                
                <div class="form-group">
                  <label>Sex *</label>
                  <select id="sex" required>
                    <option value="">Select...</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label>Insurance Provider *</label>
                  <input type="text" id="insuranceProvider" required>
                </div>
                
                <div class="form-group">
                  <label>Policy Number *</label>
                  <input type="text" id="policyNumber" required>
                </div>
                
                <div class="form-group">
                  <label>Encounter Type *</label>
                  <select id="encounterType" required>
                    <option value="">Select encounter type...</option>
                    <option value="office-visit">Office Visit</option>
                    <option value="nurse-office">Nurse's Office</option>
                    <option value="x-ray">X-Ray</option>
                    <option value="laboratory">Laboratory</option>
                    <option value="consultation">Consultation</option>
                    <option value="emergency">Emergency Visit</option>
                    <option value="follow-up">Follow-up</option>
                    <option value="physical-exam">Physical Examination</option>
                    <option value="procedure">Medical Procedure</option>
                    <option value="telehealth">Telehealth</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label>Healthcare Provider *</label>
                  <input type="text" id="healthcareProvider" required>
                </div>
                
                <button type="submit" class="btn btn-primary">Continue to Medical Notes</button>
              </form>
            </div>
          </div>

          <!-- MEDICAL NOTES SCREEN -->
          <div id="notesScreen" class="screen">
            <div class="card">
              <h2 style="margin-bottom: 20px;">Medical Notes</h2>
              
              <div class="metadata-summary" id="patientSummary"></div>
              
              <div class="notes-options">
                <button class="notes-tab active" onclick="switchNotesMode('type')">‚úçÔ∏è Type Notes</button>
                <button class="notes-tab" onclick="switchNotesMode('record')">üé§ Record Audio</button>
              </div>
              
              <div id="typeNotesMode">
                <div class="form-group">
                  <label>Medical History / Notes</label>
                  <textarea id="medicalNotes" rows="8" placeholder="Enter symptoms, diagnosis, treatment notes..."></textarea>
                </div>
                <button class="btn btn-primary" onclick="showReviewScreen()">Review & Generate Claim</button>
              </div>
              
              <div id="recordNotesMode" class="hidden">
                <div class="form-group">
                  <label>Transcribed Notes</label>
                  <textarea id="transcribedNotes" rows="8" placeholder="Paste transcribed notes here..."></textarea>
                </div>
                <button class="btn btn-primary" onclick="showReviewScreen()">Review & Generate Claim</button>
              </div>
            </div>
          </div>

          <!-- REVIEW & GENERATE SCREEN -->
          <div id="reviewScreen" class="screen">
            <div class="card">
              <h2 style="margin-bottom: 20px;">Review Information</h2>
              
              <div id="fullPatientSummary" class="metadata-summary"></div>
              
              <div class="form-group">
                <label>Medical Notes (Editable)</label>
                <textarea id="finalNotes" rows="6"></textarea>
              </div>
              
              <button class="btn btn-success" onclick="generateFinalClaim()">Generate Claim</button>
            </div>
            
            <div class="card hidden" id="generatedClaimCard">
              <h2 style="margin-bottom: 15px;">Generated Medical Claim</h2>
              <textarea class="claim-output" id="claimOutput"></textarea>
              <div class="action-buttons">
                <button class="btn btn-success" onclick="saveClaim()">Save</button>
                <button class="btn btn-primary" onclick="shareClaim()">Share</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Clinic Management System
    let currentClinic = null;
    let currentUser = null;
    let clinicData = {
      staff: [],
      claims: [],
      clinicInfo: null
    };

    // Medical Billing System
    const API_BASE = "https://emmanuel154-medical-billing-system24-7.hf.space";
    let currentPatientData = {};
    let currentMedicalScreen = 'homeScreen';
    let medicalScreenStack = [];

    // Initialize application
    function initApp() {
      const savedClinic = localStorage.getItem('currentClinic');
      const savedUser = localStorage.getItem('currentUser');
      
      if (savedClinic && savedUser) {
        currentClinic = JSON.parse(savedClinic);
        currentUser = JSON.parse(savedUser);
        
        const savedData = localStorage.getItem(`clinicData_${currentClinic.id}`);
        if (savedData) clinicData = JSON.parse(savedData);
        
        showClinicDashboard();
        startSync();
      }
      
      loadMedicalClaims();
    }

    // Clinic Setup Functions
    function showForm(type) {
      document.getElementById('createClinicForm').style.display = type === 'create' ? 'block' : 'none';
      document.getElementById('joinClinicForm').style.display = type === 'join' ? 'block' : 'none';
    }

    function createClinic() {
      const clinicName = document.getElementById('clinicName').value;
      const adminName = document.getElementById('adminName').value;
      
      if (!clinicName || !adminName) {
        alert('Please fill in all fields');
        return;
      }
      
      const clinicId = 'CLINIC-' + Math.random().toString(36).substr(2, 9).toUpperCase();
      const userId = 'USER-' + Math.random().toString(36).substr(2, 9);
      
      currentClinic = { id: clinicId, name: clinicName };
      currentUser = { id: userId, name: adminName, role: 'admin', clinicId: clinicId };
      
      clinicData.clinicInfo = currentClinic;
      clinicData.staff.push(currentUser);
      
      localStorage.setItem('currentClinic', JSON.stringify(currentClinic));
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      localStorage.setItem(`clinicData_${clinicId}`, JSON.stringify(clinicData));
      
      showClinicDashboard();
      startSync();
      alert(`Clinic created! Your Clinic ID: ${clinicId}`);
    }

    function joinClinic() {
      const clinicId = document.getElementById('joinClinicId').value.toUpperCase();
      const staffName = document.getElementById('staffName').value;
      
      if (!clinicId || !staffName) {
        alert('Please fill in all fields');
        return;
      }
      
      const savedData = localStorage.getItem(`clinicData_${clinicId}`);
      if (!savedData) {
        alert('Clinic not found. Please check the Clinic ID.');
        return;
      }
      
      clinicData = JSON.parse(savedData);
      currentClinic = clinicData.clinicInfo;
      
      const userId = 'USER-' + Math.random().toString(36).substr(2, 9);
      currentUser = { id: userId, name: staffName, role: 'staff', clinicId: clinicId };
      
      clinicData.staff.push(currentUser);
      localStorage.setItem('currentClinic', JSON.stringify(currentClinic));
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      localStorage.setItem(`clinicData_${clinicId}`, JSON.stringify(clinicData));
      
      showClinicDashboard();
      startSync();
      alert(`Joined clinic: ${currentClinic.name}`);
    }

    function showClinicDashboard() {
      document.getElementById('setupScreen').style.display = 'none';
      document.getElementById('clinicDashboard').style.display = 'block';
      
      document.getElementById('dashboardClinicName').textContent = currentClinic.name;
      document.getElementById('dashboardClinicId').textContent = currentClinic.id;
      document.getElementById('dashboardUserRole').textContent = currentUser.role;
      
      updateClinicUI();
      showMedicalScreen('homeScreen');
    }

    function updateClinicUI() {
      const staffList = document.getElementById('staffList');
      staffList.innerHTML = '';
      
      clinicData.staff.forEach(staff => {
        const staffItem = document.createElement('div');
        staffItem.className = 'staff-item';
        staffItem.innerHTML = `üë§ ${staff.name} <small>(${staff.role})</small>`;
        staffList.appendChild(staffItem);
      });
      
      document.getElementById('onlineCount').textContent = clinicData.staff.length;
    }

    function startSync() {
      setInterval(syncClinicData, 3000);
    }

    function syncClinicData() {
      if (!currentClinic) return;
      
      const syncKey = `clinicSync_${currentClinic.id}`;
      const latestData = localStorage.getItem(syncKey);
      
      if (latestData) {
        const parsedData = JSON.parse(latestData);
        if (parsedData.timestamp > (clinicData.timestamp || 0)) {
          clinicData = parsedData;
          updateClinicUI();
        }
      }
      
      clinicData.timestamp = Date.now();
      localStorage.setItem(syncKey, JSON.stringify(clinicData));
    }

    function leaveClinic() {
      if (confirm('Are you sure you want to leave this clinic?')) {
        clinicData.staff = clinicData.staff.filter(staff => staff.id !== currentUser.id);
        localStorage.setItem(`clinicData_${currentClinic.id}`, JSON.stringify(clinicData));
        
        localStorage.removeItem('currentClinic');
        localStorage.removeItem('currentUser');
        
        currentClinic = null;
        currentUser = null;
        clinicData = { staff: [], claims: [], clinicInfo: null };
        
        document.getElementById('clinicDashboard').style.display = 'none';
        document.getElementById('setupScreen').style.display = 'block';
      }
    }

    function exportClinicData() {
      const dataStr = JSON.stringify(clinicData, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `${currentClinic.name}_data.json`;
      link.click();
    }

    // Medical Billing Functions
    function showMedicalBilling() {
      document.getElementById('medicalBackBtn').style.display = 'block';
      showMedicalScreen('homeScreen');
    }

    function showMedicalScreen(screenId) {
      document.querySelectorAll('.medical-billing-ui .screen').forEach(s => s.classList.remove('active'));
      document.getElementById(screenId).classList.add('active');
      currentMedicalScreen = screenId;
    }

    function showClinicDashboard() {
      document.getElementById('medicalBackBtn').style.display = 'none';
      showMedicalScreen('homeScreen');
    }

    // Handle patient form submission
    document.getElementById('patientForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      currentPatientData = {
        patient_name: document.getElementById('patientName').value,
        age: parseInt(document.getElementById('age').value),
        sex: document.getElementById('sex').value,
        insurance_provider: document.getElementById('insuranceProvider').value,
        policy_number: document.getElementById('policyNumber').value,
        encounter_type: document.getElementById('encounterType').value,
        healthcare_provider: document.getElementById('healthcareProvider').value
      };
      
      document.getElementById('patientSummary').innerHTML = `
        <h4>Patient Summary:</h4>
        <div>Name: ${currentPatientData.patient_name}</div>
        <div>Age: ${currentPatientData.age}</div>
        <div>Insurance: ${currentPatientData.insurance_provider}</div>
      `;
      
      showMedicalScreen('notesScreen');
    });

    function switchNotesMode(mode) {
      document.getElementById('typeNotesMode').classList.toggle('hidden', mode !== 'type');
      document.getElementById('recordNotesMode').classList.toggle('hidden', mode !== 'record');
    }

    function showReviewScreen() {
      const medicalNotes = document.getElementById('medicalNotes').value || 
                          document.getElementById('transcribedNotes').value;
      
      if (!medicalNotes.trim()) {
        alert('Please enter medical notes before continuing');
        return;
      }
      
      currentPatientData.medical_history = medicalNotes;
      
      document.getElementById('fullPatientSummary').innerHTML = `
        <h4>Complete Patient Information:</h4>
        <div>Name: ${currentPatientData.patient_name}</div>
        <div>Age: ${currentPatientData.age}</div>
        <div>Sex: ${currentPatientData.sex}</div>
        <div>Insurance: ${currentPatientData.insurance_provider}</div>
        <div>Policy: ${currentPatientData.policy_number}</div>
        <div>Encounter: ${currentPatientData.encounter_type}</div>
      `;
      
      document.getElementById('finalNotes').value = medicalNotes;
      showMedicalScreen('reviewScreen');
    }

    async function generateFinalClaim() {
      currentPatientData.medical_history = document.getElementById('finalNotes').value;
      
      const payload = {
        metadata: currentPatientData,
        text: currentPatientData.medical_history
      };
      
      try {
        const response = await fetch(`${API_BASE}/submit_text`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        
        const data = await response.json();
        
        if (data.claim_text) {
          document.getElementById('claimOutput').value = data.claim_text;
          document.getElementById('generatedClaimCard').classList.remove('hidden');
        } else {
          throw new Error('Claim generation failed');
        }
      } catch (error) {
        alert('Error generating claim: ' + error.message);
      }
    }

    function saveClaim() {
      const claimText = document.getElementById('claimOutput').value;
      const fileName = `Claim_${currentPatientData.patient_name}_${Date.now()}.txt`;
      
      // Save to medical claims
      const savedClaims = JSON.parse(localStorage.getItem('medicalClaims') || '[]');
      const newClaim = {
        id: Date.now(),
        patientName: currentPatientData.patient_name,
        date: new Date().toLocaleDateString(),
        encounter: currentPatientData.encounter_type,
        claimText: claimText
      };
      savedClaims.unshift(newClaim);
      localStorage.setItem('medicalClaims', JSON.stringify(savedClaims));
      
      // Save to clinic shared data
      if (currentClinic) {
        const clinicClaim = {
          id: newClaim.id,
          patientName: currentPatientData.patient_name,
          procedure: currentPatientData.encounter_type,
          status: 'Generated',
          createdBy: currentUser.name,
          timestamp: new Date().toISOString()
        };
        
        clinicData.claims.unshift(clinicClaim);
        localStorage.setItem(`clinicData_${currentClinic.id}`, JSON.stringify(clinicData));
      }
      
      // Download file
      const blob = new Blob([claimText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = fileName;
      a.click();
      
      alert('Claim saved successfully!');
      loadMedicalClaims();
      showMedicalScreen('claimsScreen');
    }

    function loadMedicalClaims() {
      const savedClaims = JSON.parse(localStorage.getItem('medicalClaims') || '[]');
      const claimsList = document.getElementById('medicalClaimsList');
      const noClaimsMessage = document.getElementById('noClaimsMessage');
      
      if (savedClaims.length === 0) {
        claimsList.style.display = 'none';
        noClaimsMessage.style.display = 'block';
      } else {
        claimsList.style.display = 'block';
        noClaimsMessage.style.display = 'none';
        
        claimsList.innerHTML = savedClaims.map(claim => `
          <div class="medical-claim-item">
            <div>
              <h4>${claim.patientName}</h4>
              <p>${claim.date} - ${claim.encounter}</p>
            </div>
            <div>
              <button onclick="viewMedicalClaim(${claim.id})" style="padding: 5px 10px; background: #007bff; color: white; border: none; border-radius: 4px; margin-right: 5px;">View</button>
              <button onclick="deleteMedicalClaim(${claim.id})" style="padding: 5px 10px; background: #dc3545; color: white; border: none; border-radius: 4px;">Delete</button>
            </div>
          </div>
        `).join('');
      }
    }

    function viewMedicalClaim(claimId) {
      const savedClaims = JSON.parse(localStorage.getItem('medicalClaims') || '[]');
      const claim = savedClaims.find(c => c.id === claimId);
      if (claim) {
        alert(`Claim: ${claim.patientName}\n\n${claim.claimText}`);
      }
    }

    function deleteMedicalClaim(claimId) {
      if (confirm('Are you sure you want to delete this claim?')) {
        const savedClaims = JSON.parse(localStorage.getItem('medicalClaims') || '[]');
        const updatedClaims = savedClaims.filter(c => c.id !== claimId);
        localStorage.setItem('medicalClaims', JSON.stringify(updatedClaims));
        loadMedicalClaims();
      }
    }

    function shareClaim() {
      const claimText = document.getElementById('claimOutput').value;
      navigator.clipboard.writeText(claimText).then(() => {
        alert('Claim copied to clipboard!');
      });
    }

    // Initialize the application
    window.addEventListener('load', initApp);
  </script>
</body>
</html>
